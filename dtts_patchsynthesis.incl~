#include "dtts_patchsynthesis.h"
#include "dtts_match.h"

void terrain_synthesis(char* exemplar, char* output, int nw, int nh, int bsize, int osize)
{
    Terrain terrain;

    if (strstr (exemplar,".ter") || strstr (exemplar,".TER") )
    {
        terrain.loadTerragen(exemplar);
    }
    else
    {
        terrain.loadPGM(exemplar);
    }

    if (nw<0)   nw = terrain.width();
    if (nh<0)   nh = terrain.height();

    Terrain res(nw,nh);

    res.mscale = terrain.mscale;
    res.mbaseheight=terrain.mbaseheight;
    res.mheightscale = terrain.mheightscale;

    patch_synthesis(res, terrain,bsize, osize);

    if (strstr (output,".ter") || strstr (output,".TER") )
    {
        res.saveTerragen(output);
    }
    else
    {
        res.savePGM(output);
    }
}
